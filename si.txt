public List<HashMap<String, String>> consultarCombos() throws Exception {

    this.pageCombosCobros = new PageAdminCombosCobros(this);

    String combo = SettingsRun.getTestData().getParameter("Combos");
    String tipoCobro = SettingsRun.getTestData().getParameter("Tipo Prueba Cobros");
    String servicioExcel = SettingsRun.getTestData().getParameter("Servicio");
    String servicio = PageServicios.getNbLinkServicio(servicioExcel);

    int eventStatus;
    String msgReport;

    // Normalización defensiva
    combo = (combo == null) ? "" : combo.trim();
    tipoCobro = (tipoCobro == null) ? "" : tipoCobro.trim();

    // Validación obligatoria de tipo de cobro
    if (tipoCobro.isEmpty()) {
        eventStatus = Reporter.MIC_FAIL;
        Reporter.reportEvent(eventStatus,
                "Se esparaba un tipo de cobro, pero el campo se encuentra vacio.");
        SettingsRun.exitTestIteration();
    }

    // =========================
    // COBROS SIN COMBOS
    // =========================
    if ("COBROS SIN COMBOS".equals(tipoCobro)) {

        // No se esperaba combo, pero viene diligenciado
        if (!combo.isEmpty()) {
            msgReport = "No se esperaba un combo para la prueba " + tipoCobro
                    + ", se continuara la automatización, pera revisar la información.";
            Reporter.reportEvent(Reporter.MIC_WARNING, msgReport);
        }

        Evidence.save("Evidencia Inicial", this);
        results = this.pageCombosCobros.getResultsSinCombo(servicio, combo);

        String verificarCombo = results.get(0).get("Verificacion Combo");

        if (verificarCombo.contains("Empresa tiene combo")) {
            String comboNoDiligenciado = results.get(0).get("Combo encontrado no diligenciado");
            combo = comboNoDiligenciado;

            msgReport = "No se esperaba el combo '" + combo + "' para el tipo de prueba '"
                    + tipoCobro + "' para la empresa, se continuara la automatización, "
                    + "pera revisar la información desde cobro con combos.";
            Reporter.reportEvent(Reporter.MIC_WARNING, msgReport);

            results = this.pageCombosCobros.getResultsConCombo(combo, servicio);
        } else {
            msgReport = "La empresa no tiene combo como se esperaba.";
            Reporter.reportEvent(Reporter.MIC_INFO, msgReport);
        }
    }

    // =========================
    // COBROS CON COMBOS
    // =========================
    if ("COBROS CON COMBOS".equals(tipoCobro)) {

        // Se esperaba combo y no viene diligenciado
        if (combo.isEmpty()) {
            msgReport = "Se esperaba un combo para la prueba " + tipoCobro
                    + ", pero no fue ingresado, revisar la información.";
            Reporter.reportEvent(Reporter.MIC_FAIL, msgReport);
            SettingsRun.exitTestIteration();
        }

        Evidence.save("Evidencia Inicial", this);
        results = this.pageCombosCobros.getResultsConCombo(combo, servicio);

        String verificarCombo = results.get(0).get("Verificacion Combo");

        if (verificarCombo.contains("Empresa no tiene combo")) {
            String empresaSinCombo = results.get(0).get("Empresa sin combo");
            combo = empresaSinCombo;

            msgReport = "No se esperaba el combo '" + combo
                    + "' para la empresa, se continuara la automatización, "
                    + "pera revisar la información desde cobro sin combos.";
            Reporter.reportEvent(Reporter.MIC_WARNING, msgReport);

            results = this.pageCombosCobros.getResultsSinCombo(servicio, combo);
        } else {
            msgReport = "La empresa tiene combo como se esperaba.";
            Reporter.reportEvent(Reporter.MIC_INFO, msgReport);
        }
    }

    return results;
}
