Launcher:

package launchTest;

import library.core.BaseTestNG;
import library.reporting.Reporter;

import java.io.File;

import ControllerPyme.ControllerTestNomProve;
import dav.library.common.DatosEmpresarial;
import dav.library.reporting.EvidencePdfFile;
import library.settings.SettingsRun;

/**
 * Launcher ligero que orquesta y delega al PymeFlowController. Mantiene la API
 * pública original y delega la implementación concreta.
 */
public class LaunchTestNomProv extends BaseTestNG {

	private ControllerTestNomProve Controller;

	@Override
	public void launchData() {
		SettingsRun.ARRAY_DATA_PARAMS = new String[] { "Cliente Empresarial", "Tipo Identificación", "Id usuario",
				"Clave personal o CVE", "Tipo Token", "Semilla / Valor Estático / Celular", "Tipo ID Empresa",
				"Numero ID Empresa", "Nombre Empresa", "Servicio", "Tipo producto origen / Franquicia",
				"Número producto origen", "Archivo Destinos txt" };
		Reporter.initializeEvidenceType(new EvidencePdfFile());
		SettingsRun.DEFAULT_HEADER = 1;
	}

	@Override
	public void initializeControllerAndConfiguration() throws Exception {
		Controller = new ControllerTestNomProve();
		SettingsRun.getTestData().addParametersNotExist("Número Aprobación");
	}

	@Override
	public void doingTest() throws Exception {
		validateData();
		Controller.doingTest();
	}

	public void validateData() throws Exception {

		String clienteEmpresarial = SettingsRun.getTestData().getParameter("Cliente Empresarial");
		String tipoIdentificacion = SettingsRun.getTestData().getParameter("Tipo Identificación");
		String idUsuario = SettingsRun.getTestData().getParameter("Id usuario");
		String clavePersonaloCVE = SettingsRun.getTestData().getParameter("Clave personal o CVE");
		String tipoToken = SettingsRun.getTestData().getParameter("Tipo Token");
		String semilla = SettingsRun.getTestData().getParameter("Semilla / Valor Estático / Celular");

		String tipoIDEmpresa = SettingsRun.getTestData().getParameter("Tipo ID Empresa");
		String numeroIDEmpresa = SettingsRun.getTestData().getParameter("Numero ID Empresa");
		String nombreEmpresa = SettingsRun.getTestData().getParameter("Nombre Empresa");
		String servicio = SettingsRun.getTestData().getParameter("Servicio");
		String tipoProductoOrigen = SettingsRun.getTestData().getParameter("Tipo producto origen / Franquicia");
		String numeroProductoOrigen = SettingsRun.getTestData().getParameter("Número producto origen");
		String archivoDestinosTxt = SettingsRun.getTestData().getParameter("Archivo Destinos txt");

		String[] valores = { clienteEmpresarial, tipoIdentificacion, idUsuario, clavePersonaloCVE, tipoToken, semilla,
				tipoIDEmpresa, numeroIDEmpresa, nombreEmpresa, servicio, tipoProductoOrigen, numeroProductoOrigen,
				archivoDestinosTxt };

		String[] titulos = { "Cliente Empresarial", "Tipo Identificación", "Id usuario", "Clave personal o CVE",
				"Tipo Token", "Semilla / Valor Estático / Celular", "Tipo ID Empresa", "Numero ID Empresa",
				"Nombre Empresa", "Servicio", "Tipo producto origen / Franquicia", "Número producto origen",
				"Archivo Destinos txt" };

		for (int i = 0; i < valores.length; i++) {
			if (valores[i] == null || valores[i].trim().isEmpty()) {
				Reporter.reportEvent(Reporter.MIC_FAIL, "Falta diligenciar el dato: " + titulos[i]);
				SettingsRun.exitTestIteration();
			}
		}

		File archivo = new File(archivoDestinosTxt);
		if (!archivo.exists() || archivo.isDirectory()) {
			Reporter.reportEvent(Reporter.MIC_FAIL,
					"El archivo de destinos no existe o es un directorio: " + archivoDestinosTxt);
			SettingsRun.exitTestIteration();
		}
	}

}

Controller:
package ControllerPyme;

import java.io.File;
import java.io.IOException;
import java.nio.charset.StandardCharsets;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.nio.file.StandardOpenOption;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Date;
import java.util.List;
import java.util.Set;

import dav.Consultas_Y_Extractos.PageConsultasyExtractos;
import dav.library.common.DatosEmpresarial;
import dav.pymes.PageLoginPymes;
import dav.pymes.PagePortalPymes;
import dav.pymes.moduloCrearTx.ControllerCrearTx;
import dav.pymes.moduloTx.PageOrigen;
import library.common.Util;
import library.core.BasePageWeb;
import library.core.Controller;
import library.reporting.Evidence;
import library.reporting.Reporter;
import library.settings.SettingsRun;

public class ControllerTestNomProve implements Controller {

	private PageLoginPymes pageLoginPyme;
	private PagePortalPymes pagePortalPymes;
	private PageOrigen pageOrigen;
	private ControllerCrearTx controller;
	private PageConsultasyExtractos pageConsultasyExtractos;

	private String clienteEmpresarial, tipoIdentificación, idUsuario, clavePersonaloCVE, tipoToken, Semilla,
			tipoIDEmpresa, numeroIDEmpresa, nombreEmpresa, servicio, tipProductoOrigen, numeroProductoOrigen,
			archivoDestinostxt;

	private String msgError, ruta;
	private Date fechaHoraLogMR;

	private static final String[] LOGIN_KEYS = { "Cliente Empresarial", "Tipo Identificación", "Id usuario",
			"Clave personal o CVE", "Tipo Token", "Semilla / Valor Estático / Celular" };

	private static final String[] FLUJO_KEYS = { "Tipo ID Empresa", "Numero ID Empresa", "Nombre Empresa", "Servicio",
			"Tipo producto origen / Franquicia", "Número producto origen", "Archivo Destinos txt" };

	@Override
	public void destroy() {
	}

	public void cargarDatosNom() throws Exception {
		ruta = Evidence.getNbEvidenceDirectory() + File.separator + "ArchPlanoClone.txt";
		clienteEmpresarial = getParameter(LOGIN_KEYS[0]);
		tipoIdentificación = getParameter(LOGIN_KEYS[1]);
		idUsuario = getParameter(LOGIN_KEYS[2]);
		clavePersonaloCVE = getParameter(LOGIN_KEYS[3]);
		tipoToken = getParameter(LOGIN_KEYS[4]);
		Semilla = getParameter(LOGIN_KEYS[5]);

		tipoIDEmpresa = getParameter(FLUJO_KEYS[0]);
		numeroIDEmpresa = getParameter(FLUJO_KEYS[1]);
		nombreEmpresa = getParameter(FLUJO_KEYS[2]);
		servicio = getParameter(FLUJO_KEYS[3]);
		tipProductoOrigen = getParameter(FLUJO_KEYS[4]);
		numeroProductoOrigen = getParameter(FLUJO_KEYS[5]);
		archivoDestinostxt = getParameter(FLUJO_KEYS[6]);

		DatosEmpresarial.AMBIENTE_TEST = mapAmbiente(SettingsRun.getGlobalData("AMBIENTE_PYME"));
	}

	public void doingTest() throws Exception {
		cargarDatosNom();
		File archivo = new File(archivoDestinostxt);
		generarPlanoRCModificado(archivo);
		flujoSoloFront();
	}

	public void flujoSoloFront() throws Exception {

		boolean primero = true;
		loadLoginFrontDataAndReport();

//		if (pageLoginPyme == null) {
		pageLoginPyme = new PageLoginPymes();
//		}

		int hojaActual = SettingsRun.getTestData().getCurrentExec();
		int hojaSiguiente = hojaActual + 1;
		String siguienteID = SettingsRun.getTestData().getParameterByExec("Id usuario", hojaSiguiente);

//		if (!siguienteID.contentEquals(idUsuario) || SettingsRun.esIteracionInicial()) {
		msgError = pageLoginPyme.loginFront();
//		}

		if (!switchToPopupOrFail(primero))
			return;

		flujoFrontTransaccional();

		primero = false;
		switchToPopupOrFail(primero);

	}

	private String[] loadLoginFrontDataAndReport() throws Exception {
		DatosEmpresarial.loadLoginData(LOGIN_KEYS[0], LOGIN_KEYS[1], LOGIN_KEYS[2], LOGIN_KEYS[3], LOGIN_KEYS[4],
				LOGIN_KEYS[5]);
		String[] datosLogin = DatosEmpresarial.getLoginData();
		Reporter.write("Datos de Logueo Front: [" + Util.arrayToString(datosLogin, " - ") + "]");
		return datosLogin;
	}

	/**
	 * Cambia a la segunda pestaña si existe; cierra la primera. Si no, falla y
	 * termina la iteración. Mantiene el comportamiento original.
	 */
	private boolean switchToPopupOrFail(boolean primero) throws Exception {
		Util.wait(5);
		Set<String> handles = pageLoginPyme.getDriver().getWindowHandles();
		List<String> ventanas = new ArrayList<>(handles);
		if (primero) {
			if (ventanas.size() >= 2) {
				String first = ventanas.get(0);
				String second = ventanas.get(1);
				Reporter.write("Primera venta: " + first + "/r Segunda venta: " + second);
				pageLoginPyme.getDriver().switchTo().window(first);
				Util.wait(2);
				pageLoginPyme.getDriver().close();
				pageLoginPyme.getDriver().switchTo().window(second);
				return true;
			} else {
				Reporter.reportEvent(Reporter.MIC_FAIL, "No se abrio la segunda pestaña");
				SettingsRun.exitTestIteration();
				return false;
			}
		} else {
			String first = ventanas.get(0);
			pageLoginPyme.getDriver().switchTo().window(first);
			pageLoginPyme.getDriver().close();
		}
		return false;

	}

	/**
	 * Flujo transaccional dentro del Front: selección de empresa y transacciones.
	 */
	private void flujoFrontTransaccional() throws Exception {
		pageOrigen = new PageOrigen(pageLoginPyme);
		pagePortalPymes = new PagePortalPymes(pageLoginPyme);
		String localMsgError = null;

		try {
			pagePortalPymes.changeToDefaultFrame();
			localMsgError = pagePortalPymes.seleccionarEmpresa(nombreEmpresa);
			if (localMsgError != null) {
				Reporter.write(localMsgError);
			}
		} catch (Exception e) {
			// Intento alternativo igual que en original: cambiar a primer frame y
			// reintentar
			pagePortalPymes.changeToFirstFrame();
			localMsgError = pagePortalPymes.seleccionarEmpresa(nombreEmpresa);
			if (localMsgError != null) {
				Reporter.write(localMsgError);
			}
		}

		transar();
	}

	public void transar() throws Exception {
		controller = new ControllerCrearTx(pageLoginPyme);
		controller.crearPagoNomina_Proveedores(false);

		pageLoginPyme.changeToDefaultFrame();
//		pageLoginPyme.CerrarSesionFront();
//		SettingsRun.exitTestIteration();
	}

	private String mapAmbiente(String raw) throws Exception {
		if (raw == null)
			return "";
		switch (raw) {
		case "1":
		case "PROYECTOS":
			return "PROYECTOS";
		case "2":
		case "CONTENCION":
			return "CONTENCION";
		case "3":
		case "OBSOLESCENCIA":
			return "OBSOLESCENCIA";
		case "4":
		case "ONPREMISE":
			return "ONPREMISE";
		case "5":
		case "POST_NUBE":
			return "POST_NUBE";
		case "6":
		case "CONTENCION_NUBE":
			return "CONTENCION_NUBE";
		case "7":
		case "PROYECTOS_NUBE":
			return "PROYECTOS_NUBE";
		case "8":
		case "PROYECTOS_SO":
			return "PROYECTOS_SO";
		case "9":
		case "MEJORAS":
			return "MEJORAS";
		default:
			Reporter.reportEvent(Reporter.MIC_FAIL, "Opción de ambiente no válida: " + raw);
			SettingsRun.exitTestIteration();
			return raw;
		}
	}

	public void postAprobacionUnaFirma() throws Exception {
		boolean internacionales = false;

		if (!servicio.contains("Internacionales") && !servicio.contains("Divisas")
				&& !servicio.contains("Pagos Automaticos") && !servicio.contains("ORPA")) {
			pageConsultasyExtractos = new PageConsultasyExtractos(pageLoginPyme);
			String tipoProduct = SettingsRun.getTestData().getParameter("Tipo producto origen / Franquicia").trim();
			String numeroProducto = SettingsRun.getTestData().getParameter("Número producto origen").trim();

			pageConsultasyExtractos.ConsultayExtractos(servicio, "CHROME", tipoIDEmpresa, numeroIDEmpresa,
					tipoIdentificación, idUsuario, tipoProduct, numeroProducto, false, null);
		}
	}

	private String getParameter(String key) {
		return SettingsRun.getTestData().getParameter(key);
	}

	public String generarPlanoRCModificado(File archivoPlanoOriginal) throws IOException {

		Path inputPath = archivoPlanoOriginal.toPath();
		java.util.List<String> lineas = Files.readAllLines(inputPath, StandardCharsets.UTF_8);

		if (lineas.isEmpty()) {
			throw new IllegalArgumentException("El archivo plano está vacío.");
		}

		String lineaOriginal = lineas.get(0);

		StringBuilder padded = new StringBuilder(lineaOriginal);
		while (padded.length() < 170) {
			padded.append(' ');
		}
		String original = padded.toString();

		String codigoBanco = original.substring(44, 50);
		String valorTotal = original.substring(50, 68);
		String numeroTotal = original.substring(68, 74);
		String fechaProceso = original.substring(74, 82);
		String horaProceso = original.substring(82, 88);

		if (codigoBanco.trim().isEmpty()) {
			throw new IllegalArgumentException("Código de banco no existe en el plano original.");
		}

		StringBuilder rc = new StringBuilder();

		rc.append("RC");

		String numeroIDEmpresatr = Util.leftComplete(numeroIDEmpresa, 16, '0');

		rc.append(limpiar(numeroIDEmpresatr));

		rc.append(obtenerCodigoServicio(servicio));

		String numeroProductoOrigentr = Util.leftComplete(numeroProductoOrigen, 16, '0');
		rc.append(limpiar(numeroProductoOrigentr));

		rc.append(obtenerTipoCuenta(tipProductoOrigen));

		rc.append(codigoBanco);

		rc.append(valorTotal);

		rc.append(numeroTotal);

		rc.append(fechaProceso);

		rc.append(horaProceso);

		rc.append("0000");

		rc.append("9999");

		rc.append("00000000");

		rc.append("000000");

		rc.append("00");

		rc.append("03");

		rc.append("000000000000");

		rc.append("0000");

		rc.append(Util.repeat('0', 40));

		lineas.set(0, rc.toString());

		Path salida = Paths.get(ruta);
		Files.createDirectories(salida.getParent());
		Files.write(salida, lineas, StandardCharsets.UTF_8, StandardOpenOption.CREATE,
				StandardOpenOption.TRUNCATE_EXISTING);

		return salida.toAbsolutePath().toString();
	}

	// ===================== MÉTODOS AUXILIARES =====================

	private String obtenerCodigoServicio(String servicio) {
		if (servicio == null)
			return "PROVPROV";
		servicio = servicio.toLowerCase();

		if (servicio.contains("nomina") || servicio.contains("nómina")) {
			return "NOMINOMI";
		}
		return "PROVPROV";
	}

	private String obtenerTipoCuenta(String tipo) {
		if (tipo == null)
			return "CA";
		tipo = tipo.toLowerCase();

		if (tipo.contains("ahorro"))
			return "CA";
		if (tipo.contains("corriente"))
			return "CC";

		return "CA";
	}

	private String limpiar(String valor) {
		return valor == null ? "" : valor.replaceAll("[^0-9]", "");
	}

}

Error:
[1769710147.644][SEVERE]: Unable to receive message from renderer
falla
java.lang.RuntimeException: org.openqa.selenium.NoSuchSessionException: invalid session id
Build info: version: '3.141.59', revision: 'e82be7d358', time: '2018-11-14T08:17:03'
System info: host: '7020761DXCWWCP7', ip: '10.141.6.50', os.name: 'Windows 10', os.arch: 'amd64', os.version: '10.0', java.version: '1.8.0_172'
Driver info: org.openqa.selenium.chrome.ChromeDriver
Capabilities {acceptInsecureCerts: true, browserName: chrome, browserVersion: 144.0.7559.97, chrome: {chromedriverVersion: 144.0.7559.97 (80be69ef794b..., userDataDir: C:\Users\JOMAHECH\AppData\L...}, fedcm:accounts: true, goog:chromeOptions: {debuggerAddress: localhost:49901}, goog:processID: 24032, javascriptEnabled: true, networkConnectionEnabled: false, pageLoadStrategy: normal, platform: WINDOWS, platformName: WINDOWS, proxy: Proxy(), setWindowRect: true, strictFileInteractability: false, timeouts: {implicit: 0, pageLoad: 300000, script: 30000}, unhandledPromptBehavior: dismiss and notify, webauthn:extension:credBlob: true, webauthn:extension:largeBlob: true, webauthn:extension:minPinLength: true, webauthn:extension:prf: true, webauthn:virtualAuthenticators: true}
Session ID: eb4f4409559846141d4bc011d8ff2048
	at launchTest.LaunchTestNomProv.lambda$0(LaunchTestNomProv.java:53)
	at java.util.concurrent.Executors$RunnableAdapter.call(Unknown Source)
	at java.util.concurrent.FutureTask.run(Unknown Source)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)
	at java.lang.Thread.run(Unknown Source)
Caused by: org.openqa.selenium.NoSuchSessionException: invalid session id
Build info: version: '3.141.59', revision: 'e82be7d358', time: '2018-11-14T08:17:03'
System info: host: '7020761DXCWWCP7', ip: '10.141.6.50', os.name: 'Windows 10', os.arch: 'amd64', os.version: '10.0', java.version: '1.8.0_172'
Driver info: org.openqa.selenium.chrome.ChromeDriver
Capabilities {acceptInsecureCerts: true, browserName: chrome, browserVersion: 144.0.7559.97, chrome: {chromedriverVersion: 144.0.7559.97 (80be69ef794b..., userDataDir: C:\Users\JOMAHECH\AppData\L...}, fedcm:accounts: true, goog:chromeOptions: {debuggerAddress: localhost:49901}, goog:processID: 24032, javascriptEnabled: true, networkConnectionEnabled: false, pageLoadStrategy: normal, platform: WINDOWS, platformName: WINDOWS, proxy: Proxy(), setWindowRect: true, strictFileInteractability: false, timeouts: {implicit: 0, pageLoad: 300000, script: 30000}, unhandledPromptBehavior: dismiss and notify, webauthn:extension:credBlob: true, webauthn:extension:largeBlob: true, webauthn:extension:minPinLength: true, webauthn:extension:prf: true, webauthn:virtualAuthenticators: true}
Session ID: eb4f4409559846141d4bc011d8ff2048
	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance(Unknown Source)
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(Unknown Source)
	at java.lang.reflect.Constructor.newInstance(Unknown Source)
	at org.openqa.selenium.remote.http.W3CHttpResponseCodec.createException(W3CHttpResponseCodec.java:187)
	at org.openqa.selenium.remote.http.W3CHttpResponseCodec.decode(W3CHttpResponseCodec.java:122)
	at org.openqa.selenium.remote.http.W3CHttpResponseCodec.decode(W3CHttpResponseCodec.java:49)
	at org.openqa.selenium.remote.HttpCommandExecutor.execute(HttpCommandExecutor.java:158)
	at org.openqa.selenium.remote.service.DriverCommandExecutor.execute(DriverCommandExecutor.java:83)
	at org.openqa.selenium.remote.RemoteWebDriver.execute(RemoteWebDriver.java:552)
	at org.openqa.selenium.remote.RemoteWebDriver.executeScript(RemoteWebDriver.java:489)
	at library.core.BasePageWeb.saveFullScreenshot(BasePageWeb.java:763)
	at library.reporting.Evidence.saveFullPage(Evidence.java:536)
	at dav.pymes.moduloCrearTx.PageDestino.verificarContinuarCargaMasiva(PageDestino.java:747)
	at dav.pymes.moduloCrearTx.PageDestino.cargarDestinosXArchivo(PageDestino.java:740)
	at dav.pymes.moduloCrearTx.ControllerDestinosMasivos.cargarDestinos(ControllerDestinosMasivos.java:157)
	at dav.pymes.moduloCrearTx.ControllerCrearTx.crearPagoNomina_Proveedores(ControllerCrearTx.java:773)
	at ControllerPyme.ControllerTestNomProve.transar(ControllerTestNomProve.java:177)
	at ControllerPyme.ControllerTestNomProve.flujoFrontTransaccional(ControllerTestNomProve.java:172)
	at ControllerPyme.ControllerTestNomProve.flujoSoloFront(ControllerTestNomProve.java:101)
	at ControllerPyme.ControllerTestNomProve.doingTest(ControllerTestNomProve.java:78)
	at launchTest.LaunchTestNomProv.lambda$0(LaunchTestNomProv.java:51)
	... 5 more
*** NOT COMPLETED -- Exception en [BaseTestNG.TestExec2]
org.openqa.selenium.NoSuchSessionException: invalid session id
Build info: version: '3.141.59', revision: 'e82be7d358', time: '2018-11-14T08:17:03'
System info: host: '7020761DXCWWCP7', ip: '10.141.6.50', os.name: 'Windows 10', os.arch: 'amd64', os.version: '10.0', java.version: '1.8.0_172'
Driver info: org.openqa.selenium.chrome.ChromeDriver
Capabilities {acceptInsecureCerts: true, browserName: chrome, browserVersion: 144.0.7559.97, chrome: {chromedriverVersion: 144.0.7559.97 (80be69ef794b..., userDataDir: C:\Users\JOMAHECH\AppData\L...}, fedcm:accounts: true, goog:chromeOptions: {debuggerAddress: localhost:49901}, goog:processID: 24032, javascriptEnabled: true, networkConnectionEnabled: false, pageLoadStrategy: normal, platform: WINDOWS, platformName: WINDOWS, proxy: Proxy(), setWindowRect: true, strictFileInteractability: false, timeouts: {implicit: 0, pageLoad: 300000, script: 30000}, unhandledPromptBehavior: dismiss and notify, webauthn:extension:credBlob: true, webauthn:extension:largeBlob: true, webauthn:extension:minPinLength: true, webauthn:extension:prf: true, webauthn:virtualAuthenticators: true}
Session ID: eb4f4409559846141d4bc011d8ff2048
